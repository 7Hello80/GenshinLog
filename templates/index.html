<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸç¥æŠ½å¡åˆ†æ</title>
    <!-- Element UI CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- Vue 2 -->
    <script src="https://unpkg.com/vue@2/dist/vue.js"></script>
    <!-- Element UI JS -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <!-- cssæ ·å¼ -->
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://unpkg.com/mdui@2/mdui.css">
    <script src="https://unpkg.com/mdui@2/mdui.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div id="app">
        <div class="container">
            <!-- æ ‡é¢˜ -->
            <div class="header">
                <h1>åŸç¥æŠ½å¡åˆ†æ</h1>
                <p>è¾“å…¥æ‚¨çš„æŠ½å¡é“¾æ¥ï¼ŒæŸ¥çœ‹è¯¦ç»†çš„æŠ½å¡ç»Ÿè®¡æ•°æ®</p>
            </div>

            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="card">
                <div class="input-section">
                    <div class="input-flex">
                        <el-input
                            v-model="gachaUrl"
                            placeholder="è¯·è¾“å…¥æŠ½å¡é“¾æ¥"
                            clearable
                        >
                            <i slot="prefix" class="el-input__icon el-icon-link"></i>
                        </el-input>
                    </div>
                    <el-button
                        type="primary"
                        @click="analyzeGacha"
                        :loading="loading"
                        class="btn-analyze"
                    >
                        <span v-if="!loading">å¼€å§‹åˆ†æ</span>
                        <span v-else>åˆ†æä¸­...</span>
                    </el-button>
                </div>
                <div class="tip">
                    ğŸ’¡ æç¤ºï¼šä½¿ç”¨HoYoGetè·å–æŠ½å¡è®°å½•é“¾æ¥ï¼Œå¤åˆ¶é“¾æ¥åç²˜è´´åˆ°ä¸Šæ–¹è¾“å…¥æ¡†
                </div>
            </div>

            <!-- æ•°æ®å±•ç¤ºåŒºåŸŸ -->
            <div>
                <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
                <div class="card">
                    <div class="tabs-container">
                        <button
                            v-for="type in displayOrder.filter(key => gachaData[key])"
                            :key="type"
                            @click="activeTab = type"
                            :class="['tab-button', activeTab === type ? 'active' : '']"
                        >
                            {{ gachaData[type].name }}
                        </button>
                    </div>
                </div>

                <!-- å½“å‰å¡æ± æ•°æ® -->
                <div v-show="currentPool">
                    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
                    <div class="card">
                        <h2 style="font-size: 18px; font-weight: bold; color: #333; margin-bottom: 15px;">ç»Ÿè®¡æ¦‚è§ˆ</h2>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" style="color: #409eff;">{{ currentPool.stats.total_pulls }}</div>
                                <div class="stat-label">æ€»æŠ½æ•°</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" style="color: #9b59b6;">{{ currentPool.stats.five_star_count }}</div>
                                <div class="stat-label">äº”æ˜Ÿæ•°é‡</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" style="color: #27ae60;">{{ currentPool.stats.four_star_count }}</div>
                                <div class="stat-label">å››æ˜Ÿæ•°é‡</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" style="color: #f4d03f;">{{ formatNumber(currentPool.stats.total_primogems) }}</div>
                                <div class="stat-label">æ¶ˆè€—åŸçŸ³</div>
                            </div>
                        </div>
                    </div>

                    <!-- äº”æ˜ŸæŠ½å¡è®°å½• -->
                    <div class="card">
                        <h2 style="font-size: 18px; font-weight: bold; color: #333; margin-bottom: 15px;">äº”æ˜ŸæŠ½å¡è®°å½•</h2>

                        <div v-show="currentPool.pulls && currentPool.pulls.length > 0">
                            <div
                                v-for="(item, index) in reversedFiveStarPulls"
                                :key="'5star-' + index"
                                class="gacha-item"
                            >
                                <div class="gacha-content">
                                    <!-- å¤´åƒ -->
                                    <div class="avatar-container">
                                        <img
                                            :src="item.avatar_url"
                                            :alt="item.name"
                                            class="avatar"
                                        >
                                        <!-- æ­ªçš„å›¾æ¡ˆ -->
                                        <div v-if="item.is_wai" class="wai-stamp">
                                            <span class="wai-stamp-text">æ­ª</span>
                                        </div>
                                    </div>

                                    <!-- ä¿¡æ¯ -->
                                    <div class="gacha-info">
                                        <div>
                                            <span :class="['badge', item.rank_type === '5' ? 'five-star' : 'four-star']">
                                                {{ item.rank_type }}æ˜Ÿ
                                            </span>
                                            <span class="item-type">{{ item.item_type }}</span>
                                        </div>
                                        <h3 class="item-name">{{ item.name }}</h3>
                                        <p class="item-time">{{ item.time }}</p>
                                    </div>

                                    <!-- æŠ½æ•°ç»Ÿè®¡ -->
                                    <div class="gacha-stats">
                                        <div class="pulls-count">{{ item.pulls_before }}</div>
                                        <div class="pulls-label">æŠ½</div>
                                    </div>
                                </div>

                                <!-- è¿›åº¦æ¡ -->
                                <div class="progress-section">
                                    <div class="progress-header">
                                        <span>ä¿åº•è¿›åº¦</span>
                                        <span>{{ Math.min(item.pulls_before, 90) }}/90</span>
                                    </div>
                                    <div class="progress-bar-bg">
                                        <div
                                            class="progress-bar-fill"
                                            :class="getProgressBarClass(item.pulls_before)"
                                            :style="{ width: Math.min(item.pulls_before / 90 * 100, 100) + '%' }"
                                        ></div>
                                    </div>
                                    <div class="progress-labels">
                                        <span>0æŠ½</span>
                                        <span v-if="item.pulls_before >= 73" style="color: #f4d03f;">è½¯ä¿åº•ï¼ˆ73æŠ½ï¼‰</span>
                                        <span v-if="item.pulls_before >= 90" style="color: #f56c6c;">ç¡¬ä¿åº•ï¼ˆ90æŠ½ï¼‰</span>
                                        <span>90æŠ½</span>
                                    </div>
                                </div>

                                <!-- åŸçŸ³æ¶ˆè€— -->
                                <div class="cost-section">
                                    <span class="cost-label">æ¶ˆè€—åŸçŸ³: </span>
                                    <span class="cost-value">{{ formatNumber(item.primogems_cost) }}</span>
                                </div>
                            </div>
                        </div>

                        <div v-show="!currentPool.pulls || currentPool.pulls.length === 0" class="no-data">
                            <p>æš‚æ— äº”æ˜Ÿè®°å½•</p>
                        </div>
                    </div>

                    <!-- å››æ˜ŸæŠ½å¡è®°å½• -->
                    <div class="card">
                        <h2 style="font-size: 18px; font-weight: bold; color: #333; margin-bottom: 15px;">å››æ˜ŸæŠ½å¡è®°å½•</h2>

                        <div v-show="currentPool.four_star_pulls && currentPool.four_star_pulls.length > 0">
                            <div
                                v-for="(item, index) in reversedFourStarPulls"
                                :key="'4star-' + index"
                                class="gacha-item"
                            >
                                <div class="gacha-content">
                                    <!-- å¤´åƒ -->
                                    <div class="flex-shrink-0">
                                        <img
                                            :src="item.avatar_url"
                                            :alt="item.name"
                                            class="avatar"
                                        >
                                    </div>

                                    <!-- ä¿¡æ¯ -->
                                    <div class="gacha-info">
                                        <div>
                                            <span :class="['badge', item.rank_type === '5' ? 'five-star' : 'four-star']">
                                                {{ item.rank_type }}æ˜Ÿ
                                            </span>
                                            <span class="item-type">{{ item.item_type }}</span>
                                        </div>
                                        <h3 class="item-name">{{ item.name }}</h3>
                                        <p class="item-time">{{ item.time }}</p>
                                    </div>

                                    <!-- æŠ½æ•°ç»Ÿè®¡ -->
                                    <div class="gacha-stats">
                                        <div class="pulls-count">{{ item.pulls_before }}</div>
                                        <div class="pulls-label">æŠ½</div>
                                    </div>
                                </div>

                                <!-- è¿›åº¦æ¡ -->
                                <div class="progress-section">
                                    <div class="progress-header">
                                        <span>ä¿åº•è¿›åº¦</span>
                                        <span>{{ Math.min(item.pulls_before, 10) }}/10</span>
                                    </div>
                                    <div class="progress-bar-bg">
                                        <div
                                            class="progress-bar-fill"
                                            :class="getProgressBarClass4Star(item.pulls_before)"
                                            :style="{ width: Math.min(item.pulls_before / 10 * 100, 100) + '%' }"
                                        ></div>
                                    </div>
                                    <div class="progress-labels">
                                        <span>0æŠ½</span>
                                        <span v-if="item.pulls_before >= 9" style="color: #f4d03f;">ä¿åº•ï¼ˆ9æŠ½ï¼‰</span>
                                        <span>10æŠ½</span>
                                    </div>
                                </div>

                                <!-- åŸçŸ³æ¶ˆè€— -->
                                <div class="cost-section">
                                    <span class="cost-label">æ¶ˆè€—åŸçŸ³: </span>
                                    <span class="cost-value">{{ formatNumber(item.primogems_cost) }}</span>
                                </div>
                            </div>
                        </div>

                        <div v-show="!currentPool.four_star_pulls || currentPool.four_star_pulls.length === 0" class="no-data">
                            <p>æš‚æ— å››æ˜Ÿè®°å½•</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- jsæ ·å¼ -->
    <script src="/static/script.js"></script>
</body>
</html>
